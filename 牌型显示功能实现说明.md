# TheDecree ç‰Œå‹æ˜¾ç¤ºåŠŸèƒ½å®ç°è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åœ¨ TheDecree æ¸¸æˆçš„ ShowDown é˜¶æ®µç»“æŸåï¼Œæ¯ä¸ªç©å®¶çš„ç‰Œå‹ï¼ˆå¦‚"åŒèŠ± +9"ã€"ä¸€å¯¹ +3"ï¼‰ä¼šæ˜¾ç¤ºåœ¨å…¶ä¿¡æ¯é¢æ¿ä¸­ï¼Œè®©æ‰€æœ‰ç©å®¶æ¸…æ¥šçœ‹åˆ°æœ¬å›åˆçš„ç‰Œå‹ç»“æœã€‚

## ğŸ¯ å®ç°æ•ˆæœ

- **ä½ç½®**ï¼šæ˜¾ç¤ºåœ¨æ¯ä¸ªç©å®¶çš„ä¿¡æ¯é¢æ¿ï¼ˆåå­—å’Œåˆ†æ•°ä¸‹æ–¹ï¼‰
- **å†…å®¹**ï¼šç‰Œå‹åç§° + åŸºç¡€åˆ†æ•° + è·èƒœè€…é¢å¤– +1 åˆ†
  - ä¾‹å¦‚ï¼š"åŒèŠ± +9"ï¼ˆæ™®é€šç©å®¶ï¼‰
  - ä¾‹å¦‚ï¼š"åŒèŠ± +9+1"ï¼ˆè·èƒœè€…ï¼‰
- **é¢œè‰²**ï¼šæ ¹æ®ç‰Œå‹å¼ºåº¦è‡ªåŠ¨ç€è‰²
  - ğŸŸ¡ é‡‘è‰²ï¼šåŒèŠ±é¡ºã€çš‡å®¶åŒèŠ±é¡º
  - ğŸ”´ çº¢è‰²ï¼šè‘«èŠ¦ã€å››æ¡
  - ğŸ”µ é’è‰²ï¼šé¡ºå­ã€åŒèŠ±
  - âšª ç™½è‰²ï¼šå…¶ä»–ç‰Œå‹
- **æ—¶æœº**ï¼šShowDown é˜¶æ®µè®¡ç®—å®Œåˆ†æ•°åç«‹å³æ˜¾ç¤ºï¼Œæ–°å›åˆå¼€å§‹æ—¶è‡ªåŠ¨æ¸…é™¤

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. æ–°å¢æ–‡ä»¶

#### [HandTypeHelper.ts](poker_arena_client/assets/Scripts/Core/GameMode/HandTypeHelper.ts)
**ä½œç”¨**ï¼šç‰Œå‹åç§°æ˜ å°„å’Œæ ¼å¼åŒ–å·¥å…·ç±»

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```typescript
// è·å–ä¸­æ–‡åç§°
getChineseName(handType: TexasHandType): string

// è·å–è‹±æ–‡åç§°
getEnglishName(handType: TexasHandType): string

// è·å–ç‰Œå‹åˆ†æ•°
getScore(handType: TexasHandType): number

// æ ¼å¼åŒ–æ˜¾ç¤ºæ–‡æœ¬ï¼ˆå¸¦åˆ†æ•°ï¼‰
formatWithScore(handType: TexasHandType, isWinner: boolean): string
// è¿”å›ç¤ºä¾‹ï¼š"åŒèŠ± +9" æˆ– "åŒèŠ± +9+1"

// è·å–æ˜¾ç¤ºé¢œè‰²
getDisplayColor(handType: TexasHandType): string
// è¿”å›åå…­è¿›åˆ¶é¢œè‰²ï¼Œå¦‚ "#FFD700"
```

### 2. ä¿®æ”¹çš„æ–‡ä»¶

#### [TheDecreeMode.ts](poker_arena_client/assets/Scripts/Core/GameMode/TheDecreeMode.ts)

**ä¿®æ”¹ 1**ï¼šæ‰©å±• `RoundState` æ¥å£
```typescript
interface RoundState {
    // ... å…¶ä»–å­—æ®µ
    handResults: Map<string, TexasHandResult> | null;  // æ–°å¢ï¼šå­˜å‚¨ç‰Œå‹ç»“æœ
}
```

**ä¿®æ”¹ 2**ï¼šåœ¨ `processShowdown()` ä¸­ä¿å­˜ç‰Œå‹ç»“æœ
```typescript
private processShowdown(): void {
    // ... è®¡ç®—ç‰Œå‹
    this.currentRound.handResults = results;  // æ–°å¢ï¼šä¿å­˜ç»“æœ
    // ...
}
```

**ä¿®æ”¹ 3**ï¼šåœ¨ `calculateScores()` ä¸­æ˜¾ç¤ºç‰Œå‹
```typescript
private calculateScores(results: Map<string, TexasHandResult>): void {
    // ... è®¡ç®—åˆ†æ•°
    this.displayHandTypes(results);  // æ–°å¢ï¼šæ˜¾ç¤ºç‰Œå‹
}
```

**ä¿®æ”¹ 4**ï¼šæ–°å¢ `displayHandTypes()` æ–¹æ³•
```typescript
private displayHandTypes(results: Map<string, TexasHandResult>): void {
    if (!this.game.playerUIManager) return;

    const winnerId = this.currentRound?.roundWinnerId;

    for (const [playerId, result] of results) {
        const playerIndex = this.playerManager.getPlayerIndex(playerId);
        const isWinner = playerId === winnerId;
        const handTypeText = HandTypeHelper.formatWithScore(result.type, isWinner);
        const color = HandTypeHelper.getDisplayColor(result.type);

        this.game.playerUIManager.updatePlayerHandType(playerIndex, handTypeText, color);
    }
}
```

**ä¿®æ”¹ 5**ï¼šæ–°å¢ `clearHandTypeDisplays()` æ–¹æ³•
```typescript
private clearHandTypeDisplays(): void {
    if (this.game.playerUIManager) {
        this.game.playerUIManager.clearAllHandTypes();
    }
}
```

**ä¿®æ”¹ 6**ï¼šåœ¨ `startNewRound()` ä¸­æ¸…é™¤æ—§ç‰Œå‹æ˜¾ç¤º
```typescript
public startNewRound(dealerId: string): void {
    // ... åˆå§‹åŒ–å›åˆæ•°æ®
    this.clearHandTypeDisplays();  // æ–°å¢ï¼šæ¸…é™¤ä¸Šä¸€å›åˆçš„ç‰Œå‹æ˜¾ç¤º
    // ...
}
```

**ä¿®æ”¹ 7**ï¼šæ–°å¢å…¬å¼€ getter æ–¹æ³•
```typescript
// è·å–å•ä¸ªç©å®¶çš„ç‰Œå‹ç»“æœ
public getPlayerHandResult(playerId: string): TexasHandResult | null

// è·å–æ‰€æœ‰ç©å®¶çš„ç‰Œå‹ç»“æœ
public getAllHandResults(): Map<string, TexasHandResult> | null
```

---

#### [PlayerUINode.ts](poker_arena_client/assets/Scripts/UI/PlayerUINode.ts)

**ä¿®æ”¹ 1**ï¼šæ·»åŠ ç‰Œå‹æ˜¾ç¤º Label
```typescript
private handTypeLabel: Label | null = null;  // æ–°å¢å­—æ®µ
```

**ä¿®æ”¹ 2**ï¼šåœ¨ `setupChildNodes()` ä¸­æŸ¥æ‰¾ç‰Œå‹ Label
```typescript
this.handTypeLabel = this.infoPanel.getChildByName("HandTypeLabel")?.getComponent(Label) || null;
```

**ä¿®æ”¹ 3**ï¼šåœ¨ `createInfoPanel()` ä¸­åˆ›å»ºç‰Œå‹ Label
```typescript
const handTypeLabel = new Node("HandTypeLabel");
const handTypeLabelComp = handTypeLabel.addComponent(Label);
handTypeLabel.addComponent(UITransform);
handTypeLabelComp.fontSize = 16;
handTypeLabelComp.color = new cc.Color(255, 215, 0, 255); // é‡‘è‰²
handTypeLabel.setPosition(0, -50, 0);  // åœ¨åˆ†æ•°ä¸‹æ–¹
panel.addChild(handTypeLabel);
```

**ä¿®æ”¹ 4**ï¼šæ–°å¢ `setHandType()` æ–¹æ³•
```typescript
public setHandType(handTypeText: string, color?: string): void {
    if (this.handTypeLabel) {
        this.handTypeLabel.string = handTypeText;
        if (color) {
            // è§£æåå…­è¿›åˆ¶é¢œè‰²å­—ç¬¦ä¸²å¹¶åº”ç”¨
            const hexColor = color.replace('#', '');
            const r = parseInt(hexColor.substring(0, 2), 16);
            const g = parseInt(hexColor.substring(2, 4), 16);
            const b = parseInt(hexColor.substring(4, 6), 16);
            this.handTypeLabel.color = new cc.Color(r, g, b, 255);
        }
    }
}
```

**ä¿®æ”¹ 5**ï¼šæ–°å¢ `clearHandType()` æ–¹æ³•
```typescript
public clearHandType(): void {
    if (this.handTypeLabel) {
        this.handTypeLabel.string = "";
    }
}
```

---

#### [PlayerUIManager.ts](poker_arena_client/assets/Scripts/UI/PlayerUIManager.ts)

**ä¿®æ”¹ 1**ï¼šæ–°å¢ `updatePlayerHandType()` æ–¹æ³•
```typescript
public updatePlayerHandType(playerIndex: number, handTypeText: string, color?: string): void {
    const node = this._playerUINodes[playerIndex];
    if (node) {
        node.setHandType(handTypeText, color);
    }
}
```

**ä¿®æ”¹ 2**ï¼šæ–°å¢ `clearAllHandTypes()` æ–¹æ³•
```typescript
public clearAllHandTypes(): void {
    for (const node of this._playerUINodes) {
        node.clearHandType();
    }
}
```

## ğŸ”„ æ‰§è¡Œæµç¨‹

```
1. ç©å®¶å‡ºç‰Œå®Œæˆ
   â†“
2. TheDecreeMode.processShowdown()
   - è¯„ä¼°æ¯ä¸ªç©å®¶çš„ç‰Œå‹
   - ä¿å­˜ç»“æœåˆ° currentRound.handResults
   â†“
3. TheDecreeMode.calculateScores()
   - æ ¹æ®ç‰Œå‹è®¡ç®—åˆ†æ•°
   - è°ƒç”¨ displayHandTypes()
   â†“
4. TheDecreeMode.displayHandTypes()
   - éå†æ‰€æœ‰ç©å®¶çš„ç‰Œå‹ç»“æœ
   - ä½¿ç”¨ HandTypeHelper æ ¼å¼åŒ–æ˜¾ç¤ºæ–‡æœ¬
   - è°ƒç”¨ PlayerUIManager.updatePlayerHandType()
   â†“
5. PlayerUIManager.updatePlayerHandType()
   - æ‰¾åˆ°å¯¹åº”çš„ PlayerUINode
   - è°ƒç”¨ setHandType() æ›´æ–°æ˜¾ç¤º
   â†“
6. PlayerUINode.setHandType()
   - è®¾ç½® handTypeLabel çš„æ–‡æœ¬
   - åº”ç”¨é¢œè‰²
   â†“
7. ç©å®¶åœ¨ç•Œé¢ä¸Šçœ‹åˆ°ç‰Œå‹æ˜¾ç¤º
   â†“
8. ä¸‹ä¸€å›åˆå¼€å§‹æ—¶
   - TheDecreeMode.startNewRound()
   - è°ƒç”¨ clearHandTypeDisplays()
   - æ¸…é™¤æ‰€æœ‰ç‰Œå‹æ˜¾ç¤º
```

## ğŸ¨ UI å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PlayerUINode          â”‚
â”‚                         â”‚
â”‚   InfoPanel:            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ç©å®¶åå­—        â”‚   â”‚  â† NameLabel (y: 0)
â”‚   â”‚ åˆ†æ•°: 15        â”‚   â”‚  â† ScoreLabel (y: -25)
â”‚   â”‚ åŒèŠ± +9+1       â”‚   â”‚  â† HandTypeLabel (y: -50) â­ æ–°å¢
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚
â”‚   HandContainer         â”‚
â”‚   [ğŸ‚¡][ğŸ‚¢][ğŸ‚£][ğŸ‚¤][ğŸ‚¥]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. è¿è¡Œæ¸¸æˆå¹¶å®Œæˆä¸€å±€
```bash
# åœ¨ Cocos Creator ä¸­è¿è¡Œé¡¹ç›®
# æˆ–åœ¨å‘½ä»¤è¡Œè¿è¡Œæ¸¸æˆ
```

### 2. è§‚å¯Ÿ ShowDown é˜¶æ®µ
- æ‰€æœ‰ç©å®¶å‡ºç‰Œåï¼Œè¿›å…¥ ShowDown é˜¶æ®µ
- ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ç‰Œå‹å¹¶æ˜¾ç¤º

### 3. æ£€æŸ¥æ˜¾ç¤ºå†…å®¹
- âœ… æ¯ä¸ªç©å®¶çš„ä¿¡æ¯é¢æ¿ä¸‹æ–¹åº”æ˜¾ç¤ºç‰Œå‹
- âœ… è·èƒœè€…çš„ç‰Œå‹åº”æœ‰é¢å¤– "+1" æ ‡è®°
- âœ… ç‰Œå‹é¢œè‰²åº”æ ¹æ®å¼ºåº¦ä¸åŒè€Œå˜åŒ–
- âœ… æ–°å›åˆå¼€å§‹æ—¶ï¼Œç‰Œå‹æ˜¾ç¤ºåº”è‡ªåŠ¨æ¸…é™¤

### 4. æ§åˆ¶å°æ—¥å¿—
```
[TheDecree] Hand types displayed for all players
```

## ğŸ“Š ç‰Œå‹æ˜ å°„è¡¨

| ç‰Œå‹               | ä¸­æ–‡     | åŸºç¡€åˆ† | é¢œè‰²   |
|-------------------|---------|-------|--------|
| HIGH_CARD         | é«˜ç‰Œ     | 2     | ç™½è‰²   |
| ONE_PAIR          | ä¸€å¯¹     | 3     | ç™½è‰²   |
| TWO_PAIR          | ä¸¤å¯¹     | 5     | ç™½è‰²   |
| THREE_OF_A_KIND   | ä¸‰æ¡     | 7     | ç™½è‰²   |
| STRAIGHT          | é¡ºå­     | 8     | é’è‰²   |
| FLUSH             | åŒèŠ±     | 9     | é’è‰²   |
| FULL_HOUSE        | è‘«èŠ¦     | 12    | çº¢è‰²   |
| FOUR_OF_A_KIND    | å››æ¡     | 14    | çº¢è‰²   |
| STRAIGHT_FLUSH    | åŒèŠ±é¡º   | 18    | é‡‘è‰²   |
| ROYAL_FLUSH       | çš‡å®¶åŒèŠ±é¡º| 25    | é‡‘è‰²   |

**è·èƒœè€…é¢å¤–å¥–åŠ±**ï¼š+1 åˆ†

## ğŸ› å¯èƒ½çš„é—®é¢˜

### é—®é¢˜ 1ï¼šç‰Œå‹ä¸æ˜¾ç¤º
**åŸå› **ï¼šPlayerUIManager æœªåˆå§‹åŒ–
**è§£å†³**ï¼šç¡®ä¿ Game ç»„ä»¶å·²æ­£ç¡®åˆå§‹åŒ– PlayerUIManager

### é—®é¢˜ 2ï¼šé¢œè‰²ä¸æ­£ç¡®
**åŸå› **ï¼šColor å¯¹è±¡åˆ›å»ºæ–¹å¼ä¸å¯¹
**è§£å†³**ï¼šä½¿ç”¨ `new cc.Color(r, g, b, 255)` åˆ›å»ºé¢œè‰²

### é—®é¢˜ 3ï¼šç‰Œå‹æ–‡æœ¬è¢«æˆªæ–­
**åŸå› **ï¼šLabel å®½åº¦ä¸è¶³
**è§£å†³**ï¼šåœ¨ Inspector ä¸­å¢åŠ  HandTypeLabel çš„å®½åº¦ï¼Œæˆ–è®¾ç½® `overflow` æ¨¡å¼

### é—®é¢˜ 4ï¼šæ—§ç‰Œå‹ä¸æ¸…é™¤
**åŸå› **ï¼š`clearHandTypeDisplays()` æœªè°ƒç”¨
**è§£å†³**ï¼šç¡®ä¿ `startNewRound()` ä¸­æ­£ç¡®è°ƒç”¨äº†æ¸…é™¤æ–¹æ³•

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

1. **åŠ¨ç”»æ•ˆæœ**
   - ç‰Œå‹æ˜¾ç¤ºæ—¶æ·»åŠ æ·¡å…¥åŠ¨ç”»
   - è·èƒœè€…çš„ç‰Œå‹æ·»åŠ é—ªçƒæ•ˆæœ

2. **è¯¦ç»†ä¿¡æ¯**
   - ç‚¹å‡»ç‰Œå‹å¯æŸ¥çœ‹å…·ä½“æ˜¯å“ª 5 å¼ ç‰Œç»„æˆ
   - æ˜¾ç¤ºè¸¢è„šç‰Œï¼ˆkickerï¼‰ä¿¡æ¯

3. **å¤šè¯­è¨€æ”¯æŒ**
   - æ·»åŠ è‹±æ–‡æ˜¾ç¤ºé€‰é¡¹
   - æ ¹æ®ç³»ç»Ÿè¯­è¨€è‡ªåŠ¨åˆ‡æ¢

4. **éŸ³æ•ˆ**
   - ç‰Œå‹æ˜¾ç¤ºæ—¶æ’­æ”¾ä¸åŒéŸ³æ•ˆ
   - é«˜çº§ç‰Œå‹æ’­æ”¾ç‰¹æ®ŠéŸ³æ•ˆ

5. **UI ä¼˜åŒ–**
   - æ·»åŠ ç‰Œå‹å›¾æ ‡
   - ä½¿ç”¨æ›´ä¸°å¯Œçš„é¢œè‰²æ¸å˜

## ğŸ“ æ€»ç»“

æ­¤åŠŸèƒ½é€šè¿‡ä»¥ä¸‹ 4 ä¸ªæ ¸å¿ƒç»„ä»¶å®ç°ï¼š

1. **HandTypeHelper**ï¼šç‰Œå‹åç§°å’Œé¢œè‰²æ˜ å°„
2. **TheDecreeMode**ï¼šç‰Œå‹è®¡ç®—å’Œæ˜¾ç¤ºæ§åˆ¶
3. **PlayerUINode**ï¼šç‰Œå‹ UI æ˜¾ç¤º
4. **PlayerUIManager**ï¼šæ‰¹é‡ç®¡ç†æ‰€æœ‰ç©å®¶çš„ç‰Œå‹æ˜¾ç¤º

æ•´ä¸ªå®ç°éµå¾ªäº†é¡¹ç›®çš„ MVC æ¶æ„ï¼š
- **Modelï¼ˆæ•°æ®å±‚ï¼‰**ï¼šTheDecreeMode å­˜å‚¨å’Œç®¡ç†ç‰Œå‹ç»“æœ
- **Viewï¼ˆè§†å›¾å±‚ï¼‰**ï¼šPlayerUINode è´Ÿè´£ UI æ˜¾ç¤º
- **Controllerï¼ˆæ§åˆ¶å±‚ï¼‰**ï¼šPlayerUIManager åè°ƒæ•°æ®å’Œè§†å›¾

---

**å®ç°æ—¥æœŸ**ï¼š2025-12-25
**å¼€å‘è€…**ï¼šClaude Code
**ç‰ˆæœ¬**ï¼šv1.0
