# 局域网多人游戏配置指南

## 概述

你的游戏已经支持局域网多人游戏！玩家可以在同一个局域网内连接到同一个服务器进行游戏。

## 配置步骤

### 1. 启动服务器

在服务器目录运行：

```bash
cd poker_arena_server
npm start
```

服务器启动后会显示：

```
==================================================
🎮 Poker Arena Server
==================================================
✅ Local: http://localhost:3000
✅ Network: http://192.168.1.100:3000
✅ WebSocket: ws://192.168.1.100:3000
✅ CORS Origin: http://localhost:8080
==================================================
📱 局域网玩家请使用: http://192.168.1.100:3000
==================================================
Server is ready to accept connections!
```

**重要**：记下 `Network` 那一行显示的 IP 地址（例如 `192.168.1.100`）

### 2. 配置客户端

打开文件：`poker_arena_client/assets/Scripts/Config/NetworkConfig.ts`

修改 `SERVER_IP` 为服务器的局域网 IP：

```typescript
export class NetworkConfig {
    // 本机测试：使用 'localhost'
    // 局域网游戏：修改为服务器的局域网 IP
    private static SERVER_IP: string = '192.168.1.100'; // 改成你的服务器 IP

    private static SERVER_PORT: number = 3000;

    // ...
}
```

### 3. 构建并运行客户端

在 Cocos Creator 中：
1. 打开项目
2. 点击 "项目" -> "构建发布"
3. 选择目标平台（Web、Windows、Mac 等）
4. 点击 "构建"
5. 构建完成后点击 "运行"

## 不同场景的配置

### 场景 1：本机测试（单人）

```typescript
private static SERVER_IP: string = 'localhost';
```

服务器和客户端都在同一台电脑上运行。

### 场景 2：局域网多人游戏

**服务器电脑**：
- 运行服务器：`npm start`
- 记下显示的局域网 IP（如 `192.168.1.100`）

**所有玩家电脑**：
- 修改 `NetworkConfig.ts` 中的 `SERVER_IP` 为服务器的局域网 IP
- 构建并运行客户端
- 所有玩家连接到同一个服务器

### 场景 3：动态配置（高级）

如果你想让玩家在游戏中输入服务器 IP，可以使用：

```typescript
// 在游戏启动时或登录界面
NetworkConfig.setServerIP('192.168.1.100');
```

## 防火墙设置

确保服务器电脑的防火墙允许端口 3000 的入站连接：

### Windows 防火墙

1. 打开 "Windows Defender 防火墙"
2. 点击 "高级设置"
3. 点击 "入站规则" -> "新建规则"
4. 选择 "端口" -> "下一步"
5. 选择 "TCP"，输入端口 "3000" -> "下一步"
6. 选择 "允许连接" -> "下一步"
7. 全选（域、专用、公用）-> "下一步"
8. 输入名称 "Poker Arena Server" -> "完成"

### macOS 防火墙

1. 打开 "系统偏好设置" -> "安全性与隐私" -> "防火墙"
2. 点击 "防火墙选项"
3. 点击 "+" 添加 Node.js 应用
4. 允许传入连接

## 测试连接

### 测试服务器是否可访问

在任何一台局域网电脑的浏览器中访问：

```
http://192.168.1.100:3000/health
```

如果看到 `{"status":"ok","timestamp":"..."}` 说明服务器可以访问。

### 查看服务器状态

访问：

```
http://192.168.1.100:3000/stats
```

可以看到当前连接的玩家数、房间数等信息。

## 常见问题

### Q: 客户端无法连接到服务器

**A**: 检查以下几点：
1. 服务器是否正在运行？
2. 客户端配置的 IP 地址是否正确？
3. 防火墙是否允许端口 3000？
4. 是否在同一个局域网内？

### Q: 如何找到服务器的局域网 IP？

**A**:
- Windows: 打开命令提示符，输入 `ipconfig`，查找 "IPv4 地址"
- macOS/Linux: 打开终端，输入 `ifconfig` 或 `ip addr`，查找 inet 地址
- 或者直接看服务器启动时显示的 IP

### Q: 可以在互联网上玩吗？

**A**: 当前配置仅支持局域网。如果要支持互联网游戏，需要：
1. 配置路由器端口转发（将外网端口 3000 转发到服务器内网 IP 的 3000 端口）
2. 使用公网 IP 或域名
3. 考虑使用 HTTPS 和 WSS（加密连接）

## 架构说明

```
┌─────────────────┐
│  玩家 1 客户端   │ ──┐
└─────────────────┘   │
                      │
┌─────────────────┐   │    ┌──────────────────┐
│  玩家 2 客户端   │ ──┼───→│  游戏服务器       │
└─────────────────┘   │    │  (192.168.1.100) │
                      │    └──────────────────┘
┌─────────────────┐   │
│  玩家 3 客户端   │ ──┘
└─────────────────┘
```

所有客户端连接到同一个服务器，服务器负责：
- 房间管理
- 游戏逻辑
- 状态同步
- 消息广播

## 下一步

- [ ] 添加 UI 界面让玩家输入服务器 IP
- [ ] 添加连接状态指示器
- [ ] 添加重连机制
- [ ] 支持互联网游戏（需要公网 IP 或云服务器）
